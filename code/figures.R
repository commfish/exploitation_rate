# K.Palof    ADF&G 
# katie.palof@alaska.gov
# 2018-7-27

# File to create figures used in the document for this analysis 

# load ---
source('./code/packages.R')

# data ---
# must run analysis in 'exploitation_rate_rkc.R' file for area data files and figure file.
fig_summary <- read.csv('./results/summary_for_use_in_figures.csv')

# need fig_summary here
fig_summary %>% 
  filter(area == 'lynn') %>% 
  filter(value != 'avg.hr', value != 'avg.pop.change')-> ls_fig
fig_summary %>% 
  filter(area == 'pybus') %>% 
  filter(value != 'avg.hr', value != 'avg.pop.change') -> pb_fig
fig_summary %>% 
  filter(area == 'gambier') %>% 
  filter(value != 'avg.hr', value != 'avg.pop.change') -> gb_fig
fig_summary %>% 
  filter(area == 'seymour') %>% 
  filter(value != 'avg.hr', value != 'avg.pop.change') -> sc_fig
fig_summary %>% 
  filter(area == 'peril') %>% 
  filter(value != 'avg.hr', value != 'avg.pop.change') -> ps_fig
fig_summary %>% 
  filter(area == 'excursion') %>% 
  filter(value != 'avg.hr', value != 'avg.pop.change') -> ei_fig
fig_summary %>% 
  filter(area == 'juneau') %>% 
  filter(value != 'avg.hr', value != 'avg.pop.change') -> jnu_fig

# each area needs area data file, figure file, what x is and the name of the area
# load function below ********** -----
hr_figure(lynn, ls_fig, 'Lynn Sisters')
hr_figure(pybus, pb_fig, 'Pybus Bay')
hr_figure(gambier, gb_fig, 'Gambier Bay')
hr_figure(seymour, sc_fig, 'Seymour Canal')
hr_figure(peril, ps_fig, 'Peril Strait')
hr_figure(excursion, ei_fig, 'Excursion Inlet')

# juneau figure -----
ggplot(juneau, aes(hrate, change_b)) +
  geom_point() +
  geom_smooth(method= lm) +
  geom_hline(yintercept = 0) +
  geom_vline(data = jnu_fig, aes(xintercept = rate, linetype = value, color = value),
             lwd = 1.05) +
  scale_linetype_manual(name = "", values = c("dashed", "dotted", "solid")) +
  scale_colour_manual(name = "", values = c("purple","gray65", "black"))+
  theme(legend.position = c(0.750,0.793), legend.title = element_text(size = 9), 
        legend.text = element_text(size = 8), 
        plot.title = element_text(hjust =0.5)) +
  ggtitle('Juneau') + xlab("Harvest Rate") + 
  ylab("Change in Adjusted Mature Biomass") + 
  ggsave('./figures/Juneau.png', dpi = 300, width = 6.5, height = 4.0, 
         unit = "in") 

### RKC HR presenation figures -----
# just need Pybus and Juneau
# run exploitation_rate_rkc.R for those two areas 
head(fig_summary)
fig_summary %>% 
  filter(area %in% c("juneau", "pybus")) %>% 
  filter(value != 'avg.hr', value != 'avg.pop.change') %>%
  mutate(label = ifelse(value == "equ.er.adj", "neutral", ifelse(value == "alt.equ.hr", "high", 
                                                                 "low"))) %>% 
  filter(area == "juneau") -> jnu_fig

ggplot(juneau, aes(hrate, change_b)) +
  geom_point() +
  geom_smooth(method= lm) +
  geom_hline(yintercept = 0) +
  geom_vline(data = jnu_fig, aes(xintercept = rate, linetype = label, color = label),
             lwd = 0.75) +
  scale_linetype_manual(name = "", values = c("solid", "solid", "solid")) +
  scale_colour_manual(name = "", values = c("green4","red3", "black"))+
  theme(legend.position = "none",
        plot.title = element_text(hjust =0.5)) +
  geom_text(data = jnu_fig, aes(x = c(0.095, 0.077, 0.174), y = c(0.17, 0.25, 0.25 ), label = label, 
                                colour = label), 
            hjust = -0.45, vjust = 1.5, nudge_y = 0.05, size = 5.5) + 
  ggtitle('Juneau') + xlab("Harvest Rate") + 
  ylab("Change in Adjusted Mature Biomass") + 
  ggsave('./figures/Juneau_presentation.png', dpi = 300, width = 6.5, height = 4.0, 
         unit = "in") 

fig_summary %>% 
  filter(area %in% c("juneau", "pybus")) %>% 
  filter(value != 'avg.hr', value != 'avg.pop.change') %>%
  mutate(label = ifelse(value == "equ.er.adj", "neutral", ifelse(value == "alt.equ.hr", "high", 
                                                                 "low"))) %>% 
  filter(area == "pybus") -> pb_fig

ggplot(pybus, aes(adj_hrate, change_b)) +
  geom_point() +
  geom_smooth(method= lm) +
  geom_hline(yintercept = 0) +
  geom_vline(data = pb_fig, aes(xintercept = rate, linetype = label, color = label),
             lwd = 0.75) +
  scale_linetype_manual(name = "", values = c("solid", "solid", "solid")) +
  scale_colour_manual(name = "", values = c("green4","red3", "black"))+
  theme(legend.position = "none",
        plot.title = element_text(hjust =0.5)) +
  geom_text(data = pb_fig, aes(x = c(0.10, 0.023, 0.183), y = c(0.75, 1.0, 1.0 ), label = label, 
                                colour = label), 
            hjust = -0.45, vjust = 1.5, nudge_y = 0.05, size = 5.5) + 
  ggtitle('Pybus') + xlab("Harvest Rate") + 
  ylab("Change in Adjusted Mature Biomass") + 
  ggsave('./figures/Pybus_presentation.png', dpi = 300, width = 6.5, height = 4.0, 
         unit = "in") 
# FUNCTION --- Figure for document ----- 
# each area needs area data file, figure file, what x is and the name of the area
# area = lynn
# figure = ls_fig
# x = adj_hrate
# name = 'Lynn Sisters'

hr_figure <- function(area, figure, name)  {
  ggplot(area, aes(adj_hrate, change_b)) +
    geom_point() +
    geom_smooth(method= lm) +
    geom_hline(yintercept = 0) +
    geom_vline(data = figure, aes(xintercept = rate, linetype = value, color = value),
               lwd = 1.05) +
    scale_linetype_manual(name = "", values = c("dashed", "dotted", "solid")) +
    scale_colour_manual(name = "", values = c("purple","grey34", "black"))+
    theme(legend.position = c(0.750,0.793), legend.title = element_text(size = 9), 
          legend.text = element_text(size = 8), 
          plot.title = element_text(hjust =0.5)) +
    ggtitle(name) + xlab("Harvest Rate") + 
    ylab("Change in Adjusted Mature Biomass") + 
    ggsave(paste0('./figures/', name,'.png'), dpi = 300, width = 6.5, height = 4.0, 
           unit = "in") }




  
