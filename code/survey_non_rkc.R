#  Code to assign RKC stat areas into "survey" or "non" groups.
#   Currently uses data obtained from fish ticket in ALEX query of:
#     red and blue king crab (species 921, 922), registration area A, all fish ticket years 

# K.Palof    ADF&G 
# katie.palof@alaska.gov
# 2018-3-23

# load ---
source('./code/packages.R')

# data -----
## if using ALEX output use this file
harvest <- read.xlsx('data/RKC and BKC historical data - Reg Area A.xlsx', sheetName = "Rinput")

# file to convert stat areas into survey areas
survey.area <- read.xlsx('data/rkc_biomass_2017_model.xlsx', sheetName = "Sheet2")


## data clean up - ALEX harvest file -----------
harvest %>% 
  rename(year = YEAR, cdate = CATCH_DATE, season = SEASON, numbers = NUMBERS, pounds = POUNDS) %>% 
  select(year, TICKET_NO, cdate, season, I_FISHERY, STAT_AREA, DISTRICT, SUB_DISTRICT, 
         SPECIES_CODE, numbers, pounds, POTS) -> harvest_all

## file for use by others------
harvest %>% 
  left_join(survey.area) %>% 
  mutate(area_type = ifelse(is.na(survey.area), "non", "survey"))-> harvest_file1

write.csv(harvest_file1, './results/all_years_harvest_survey_non.csv')

## survey vs non totals ---
harvest_all %>%
  left_join(survey.area) %>% 
  mutate(area_type = ifelse(is.na(survey.area), "non", "survey")) -> harvest_area_type

harvest_area_type %>% 
  group_by(season, area_type) %>% 
  summarise(pounds = sum(pounds)) ->harvest_by_year
