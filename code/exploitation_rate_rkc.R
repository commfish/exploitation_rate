# redo of a 2013 analysis looking at an "equlibrium" harvest rate (a harvest rate where the overall change in 
#     in the population would be 0).
# This analysis uses southeast alaksa red king crab data. But could be applied to other populations.

# K.Palof    ADF&G 
# katie.palof@alaska.gov
# 2018-3-23

# load ---
source('./code/packages.R')

# data -----
# Data is sourced from two place.  Annual biomas estimates are from the output of the CSA model for each area
#     in 2017 (stored in excel files for sharability with name of area). Harvest is taken from fish tickets
#     the files here are from the old fish ticket data base (prior to 1985) and the new database.  
#       **FLAG** These values need to be checked with ALEX output to make sure they are pulling the correct harvest

biomass <- read.xlsx('data/rkc_biomass_2017_model.xlsx', sheetName = "Sheet1") 

harvest1 <- read.csv('data/old_fish_tickets.csv')
harvest2 <- read.csv('data/fish_tickest_rkc_newer.csv')


# data clean up --------
harvest1 %>% 
  rename(year = Ã¯..Year.Landed, stat_area = Stat.Area, pounds = Landed.Weight..sum., species = Species.Code) %>% 
  mutate(season = ifelse(Month.Landed >=11, year, year-1)) ->harvest1

harvest1 %>% 
  group_by(season, stat_area, species) %>% 
  summarise(pounds = sum(pounds)) -> harvest_74_84

harvest2 %>% 
  rename(year = DOL.Year, stat_area = Stat.Area, pounds = Landed.Weight..sum., species.name = Species.Name) %>% 
  mutate(season = ifelse(DOL.Month >=11, year, year-1)) ->harvest2

harvest2 %>% 
  group_by(season, stat_area, species.name) %>% 
  summarise(pounds = sum(pounds)) -> harvest_88_17
